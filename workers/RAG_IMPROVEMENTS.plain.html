<div><h1 id="rag-improvements-plan">RAG Improvements Plan</h1><h2 id="status-phases-1-3--5-complete">Status: Phases 1-3 &#x26; 5 Complete</h2><p>Crawl running: ~850+/2900 sources, ~3250+ images uploaded</p><h2 id="improvement-order">Improvement Order</h2><h3 id="phase-1-query-classification-done">Phase 1: Query Classification (DONE)</h3><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked disabled> Classify incoming queries by type: product, recipe, blog, support, general</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Route queries to prioritize relevant source types</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Foundation for smarter image/content matching</li>
<li>Implemented in: <code>src/lib/query-classifier.js</code></li>
<li>Integrated into: <code>src/lib/rag.js</code></li>
<li>Classification returned with RAG results for downstream use</li>
</ul><h3 id="phase-2-image-search-via-vectorize-done">Phase 2: Image Search via Vectorize (DONE)</h3><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked disabled> Create embeddings for image alt_text + context</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Store in separate Vectorize index: <code>adaptive-web-images</code></li>
<li class="task-list-item"><input type="checkbox" checked disabled> Enable semantic image search: "smoothie" → smoothie photos</li>
<li>Implemented in: <code>src/lib/image-search.js</code></li>
<li>API endpoints: <code>/api/search-images</code>, <code>/api/index-images</code></li>
<li>3000+ images indexed</li>
</ul><h3 id="phase-3-use-rag-images--hybrid-strategy-done">Phase 3: Use RAG Images + Hybrid Strategy (DONE)</h3><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked disabled> Products: Use real product images from RAG</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Recipes: Use real recipe photos from RAG</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Hero/lifestyle: Generate with Imagen when no RAG match</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Match images to content based on semantic similarity</li>
<li>Implemented in: <code>src/lib/hybrid-images.js</code></li>
<li>Integrated into: <code>src/generate-page.js</code></li>
<li>Result: Recipe query → 4 RAG images found → No Imagen needed!</li>
</ul><h3 id="phase-4-better-content-chunking-next-crawl">Phase 4: Better Content Chunking (next crawl)</h3><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> Semantic chunking by paragraphs/sections</li>
<li class="task-list-item"><input type="checkbox" disabled> Include richer metadata: product name, category, price</li>
<li class="task-list-item"><input type="checkbox" disabled> Better context preservation</li>
</ul><h3 id="phase-5-caching-layer-done">Phase 5: Caching Layer (DONE)</h3><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked disabled> Cache RAG results for common queries</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Reduce latency and API costs</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Using Cloudflare KV with 1-hour TTL</li>
<li>Implemented in: <code>src/lib/rag-cache.js</code></li>
<li>KV namespace: <code>RAG_CACHE</code></li>
<li>Test endpoint: <code>/api/test-rag?q=query</code></li>
<li>Result: Cache HIT = 4ms vs Cache MISS = 1263ms (315x faster!)</li>
</ul><h3 id="phase-6-image-deduplication-next-crawl">Phase 6: Image Deduplication (next crawl)</h3><ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled> Hash images by source URL before upload</li>
<li class="task-list-item"><input type="checkbox" disabled> Skip duplicates to save R2 storage</li>
<li class="task-list-item"><input type="checkbox" disabled> Update crawler script</li>
</ul></div>
<div><h2 id="notes">Notes</h2><ul>
<li>Phases 1-3, 5 complete and deployed</li>
<li>Phases 4, 6 require crawler modifications (next crawl)</li>
</ul></div>